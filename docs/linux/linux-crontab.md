Linux命令之crontab
=================

# 概述
> crontab是Unix和Linux系统下的管理计划任务的一个命令。
> 用于系统运行过程中在指定时间完成指定任务。

# 命令格式

```shell
crontab [选项]
```

选项:  

* -l    显示当前所有计划任务列表  
* -e    编辑计划任务  
* -r    删除所有计划任务  

# 计划任务配置文件

## 计划任务语法

> 一共6列，前面5列是时间，每列用空格隔开，每条计划任务用换行符隔开，也就是一行一条。

```
分 时 日 月 周 命令
```

## 时间顺序&数字范围

```
*    *    *    *    *
-    -    -    -    -
|    |    |    |    |
|    |    |    |    |
|    |    |    |    +----- 周day of week (0 - 6) (Sunday=0 or 7)
|    |    |    +---------- 月month (1 - 12)
|    |    +--------------- 日day of month (1 - 31)
|    +-------------------- 时hour (0 - 23)
+------------------------- 分min (0 - 59)
```

## 时间列的语法

```
数字    表示精确值
*       表示所有可能的值
/       表示指定时间的间隔频率
,       用逗号隔开的值指定一个列表范围
-       用中杠隔开的值的一个区间范围
```

# 案例

```shell
30 8 * * * 命令       #每天08:30分执行命令
30 7 */3 * * 命令     #每个月每隔3天的7:30执行命令
0 0 8,10,12 * * 命令  #每个月的8号、10号、12号的0:0执行命令
20 8 1-7 * * 命令     #每个月1号至7号的8:20执行命令
0 8,9 1-7 * * 命令    #每个月1号至7号的8点和9点执行命令
0 8-20/3 * * * 命令   #每天8点至20点每隔3个小时执行命令
```

# 其他

* 计划任务配置文件保存的位置： /var/spool/cron/<你的用户名>
* 计划任务执行记录：/var/log/cron
* 校验计划任务配置文件：<http://tool.lu/crontab/>
* 取消计划任务邮件提醒：在配置文件第一行增加`MAILTO=""`

## 执行时间低于1分钟时的解决办法

新建一个sh文件，内容如下，加入计划任务，每分钟执行一次。

```shell
#!/bin/bash

step=10 #间隔的秒数，不能大于60，最好能整除。

for (( i = 0; i < 60; i=(i+step) )); do
    $(php '/path/to/file.php')
    sleep $step
done

exit 0
```
